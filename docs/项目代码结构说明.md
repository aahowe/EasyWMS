# EasyWMS 项目代码结构说明

**版本：** V1.0  
**更新日期：** 2025-12-22

---

## 文档说明

本文档详细说明 EasyWMS 项目的代码结构、技术架构、数据库设计和开发规范。

**配套文档：** `功能需求说明书.md` - 详细的功能需求和业务流程说明

---

## 目录

1. [项目概览](#1-项目概览)
2. [技术架构](#2-技术架构)
3. [数据库设计](#3-数据库设计)
4. [后端项目结构](#4-后端项目结构)
5. [前端项目结构](#5-前端项目结构)
6. [API接口规范](#6-api接口规范)
7. [开发规范](#7-开发规范)
8. [部署说明](#8-部署说明)

---

## 1. 项目概览

### 1.1 项目信息

| 项目 | 说明 |
| --- | --- |
| 项目名称 | 简易仓库管理系统 (EasyWMS) |
| 技术架构 | Go + Vue 3 + MySQL |
| 开发模式 | 前后端分离 |
| 部署方式 | Docker / 传统部署 |

### 1.2 技术栈

**后端技术栈**
- Go 1.20+
- Gin Web Framework
- GORM (ORM)
- JWT (身份认证)
- Viper (配置管理)
- BCrypt (密码加密)

**前端技术栈**
- Vue 3
- Ant Design Vue (UI组件库)
- VxeTable (高性能表格)
- Vite
- Pinia (状态管理)
- Axios (HTTP客户端)
- ECharts (图表)

**数据库**
- MySQL 8.0
- InnoDB 引擎
- UTF8MB4 字符集

### 1.3 项目目录结构

```
EasyWMS/
├── apps/
│   ├── backend/           # 后端项目（Go）
│   │   ├── cmd/
│   │   │   └── server/
│   │   │       └── main.go    # 应用入口
│   │   ├── internal/
│   │   │   ├── config/        # 配置管理
│   │   │   ├── database/      # 数据库连接
│   │   │   ├── handler/       # HTTP处理器
│   │   │   ├── middleware/    # 中间件
│   │   │   ├── model/         # 数据模型
│   │   │   ├── router/        # 路由配置
│   │   │   └── utils/         # 工具函数
│   │   ├── config/            # 配置文件
│   │   ├── go.mod             # Go模块定义
│   │   └── README.md
│   └── frontend/          # 前端项目（Vue 3）
├── db/                    # 数据库脚本
│   └── init_all.sql       # 完整初始化脚本（建表+数据）
├── docs/                  # 项目文档
│   ├── 功能需求说明书.md
│   ├── 项目代码结构说明.md
│   └── Docker部署指南.md
└── README.md
```

---

## 2. 技术架构

### 2.1 系统分层架构

系统采用经典的五层架构设计：

**表现层 (Frontend)**
- 职责：用户界面展示、用户交互、前端数据校验
- 技术：Vue 3 + Element Plus
- 特点：基于RBAC模型的动态菜单、响应式布局

**处理器层 (Handler)**
- 职责：HTTP请求处理、参数解析、业务逻辑、响应封装
- 技术：Gin Framework + GORM
- 特点：RESTful API设计、统一响应格式、事务控制

**数据模型层 (Model)**
- 职责：数据结构定义、ORM映射
- 技术：GORM Struct Tags
- 特点：与数据库表一一对应

**中间件层 (Middleware)**
- 职责：请求拦截、认证授权、日志记录、跨域处理
- 技术：Gin Middleware
- 特点：JWT认证、CORS支持

---

## 3. 数据库设计

### 3.1 数据库概览

**数据库名称：** easywms  
**字符集：** utf8mb4  
**排序规则：** utf8mb4_unicode_ci  
**存储引擎：** InnoDB  
**脚本位置：**
- 完整初始化脚本：`db/init_all.sql`（包含建表和初始数据）

### 3.2 表结构概览

系统共14张表，分为基础数据表和业务单据表两大类。

**基础数据表（5张）**
1. `sys_user` - 系统用户表
2. `base_department` - 部门表
3. `base_supplier` - 供应商表
4. `base_category` - 物资分类表
5. `base_product` - 物资档案表

**业务单据表（9张）**
6. `biz_procurement` - 采购订单主表
7. `biz_procurement_item` - 采购明细表
8. `biz_inbound` - 入库单主表
9. `biz_inbound_item` - 入库明细表
10. `biz_outbound` - 出库主表
11. `biz_outbound_item` - 领用明细表
12. `biz_stock_log` - 库存流水表
13. `biz_inventory_check` - 盘点主表
14. `biz_inventory_check_item` - 盘点差异表

### 3.3 核心表设计

#### sys_user - 系统用户表

存储所有登录账号、密码及角色身份。

| 字段 | 类型 | 说明 |
| --- | --- | --- |
| id | BIGINT | 主键、自增 |
| username | VARCHAR(64) | 登录账号（唯一） |
| password | VARCHAR(128) | 密码（BCrypt加密） |
| real_name | VARCHAR(64) | 真实姓名 |
| dept_id | BIGINT | 部门ID（外键） |
| role_code | VARCHAR(20) | 角色编码（ADMIN/BUYER/W_MGR/STAFF） |
| status | TINYINT | 状态（1-启用, 0-禁用） |
| created_at | DATETIME | 创建时间 |
| updated_at | DATETIME | 更新时间 |

#### base_product - 物资档案表

系统的核心资产表，定义物资规格并存储实时库存。

| 字段 | 类型 | 说明 |
| --- | --- | --- |
| id | BIGINT | 主键、自增 |
| category_id | BIGINT | 所属分类ID（外键） |
| sku_code | VARCHAR(64) | SKU编码（唯一） |
| name | VARCHAR(128) | 物资名称 |
| specification | VARCHAR(128) | 规格型号 |
| unit | VARCHAR(20) | 计量单位 |
| stock_qty | DECIMAL(14,4) | 实时库存（悲观锁扣减对象） |
| alert_threshold | DECIMAL(14,4) | 预警阈值 |
| status | TINYINT | 状态（1-启用, 0-停用） |
| created_at | DATETIME | 创建时间 |
| updated_at | DATETIME | 更新时间 |

#### biz_stock_log - 库存流水表

系统的"总账本"，不可篡改地记录每一次库存变动。

| 字段 | 类型 | 说明 |
| --- | --- | --- |
| id | BIGINT | 主键、自增 |
| product_id | BIGINT | 物资ID（外键） |
| type | VARCHAR(10) | 变动类型（IN/OUT/ADJUST） |
| change_qty | DECIMAL(14,4) | 变动数量（正数增、负数减） |
| snapshot_qty | DECIMAL(14,4) | 变动后的库存快照 |
| related_no | VARCHAR(32) | 关联单号 |
| operator_id | BIGINT | 操作人ID（外键） |
| created_at | DATETIME | 发生时间 |

### 3.4 外键关系图

```
sys_user.dept_id → base_department.id
base_product.category_id → base_category.id
biz_procurement.applicant_id → sys_user.id
biz_procurement.supplier_id → base_supplier.id
biz_inbound.source_id → biz_procurement.id
biz_outbound.applicant_id → sys_user.id
biz_outbound.dept_id → base_department.id
biz_stock_log.product_id → base_product.id
```

### 3.5 初始化数据

`db/data.sql` 包含以下测试数据：

- **7个部门**：总经办、研发部、采购部、仓储部、行政部、前端组、后端组
- **5个用户**：admin（管理员）、buyer01（采购）、warehouse01（仓管）、staff01/02（员工）
- **5个供应商**：晨光文具、得力办公、联想电子、华为技术、3M中国
- **8个物资分类**：办公用品、电子设备、劳保用品及其子分类
- **10个物资档案**：中性笔、铅笔、A4纸、笔记本电脑、路由器、口罩等
- **10条期初库存流水**：对应10个物资的初始库存

**默认密码**：所有用户密码均为 `123456`（BCrypt加密）

---

## 4. 后端项目结构

### 4.1 目录结构详解

```
apps/backend/
├── cmd/
│   └── server/
│       └── main.go              # 应用入口，初始化配置和路由
├── internal/
│   ├── config/
│   │   └── config.go            # 配置结构定义和加载
│   ├── database/
│   │   └── database.go          # 数据库连接初始化
│   ├── handler/                 # HTTP处理器
│   │   ├── auth.go              # 认证处理
│   │   ├── category.go          # 分类管理
│   │   ├── dashboard.go         # 仪表盘统计
│   │   ├── inbound.go           # 入库管理
│   │   ├── inventory_check.go   # 盘点管理
│   │   ├── outbound.go          # 出库管理
│   │   ├── procurement.go       # 采购管理
│   │   ├── product.go           # 物资管理
│   │   ├── stock.go             # 库存管理
│   │   └── supplier.go          # 供应商管理
│   ├── middleware/              # 中间件
│   │   ├── auth.go              # JWT认证中间件
│   │   ├── cors.go              # CORS跨域中间件
│   │   └── logger.go            # 日志中间件
│   ├── model/                   # 数据模型（GORM实体）
│   │   ├── user.go              # 用户模型
│   │   ├── department.go        # 部门模型
│   │   └── product.go           # 物资模型
│   ├── router/                  # 路由配置
│   │   └── router.go            # 路由注册
│   └── utils/                   # 工具函数
│       ├── response.go          # 统一响应格式
│       ├── jwt.go               # JWT工具
│       └── password.go          # 密码加密工具
├── config/                      # 配置文件
│   ├── config.yaml              # 实际配置（不提交）
│   └── config.example.yaml      # 配置示例
├── go.mod                       # Go模块定义
├── Dockerfile                   # Docker构建文件
└── README.md                    # 项目说明
```

### 4.2 核心组件说明

#### 4.2.1 配置管理 (config)

使用 Viper 加载 YAML 配置文件，支持：
- 服务器配置（端口、运行模式）
- 数据库配置（连接信息、连接池）
- JWT配置（密钥、过期时间）
- 日志配置（级别、文件路径）
- CORS配置（允许的域名、方法、头部）

#### 4.2.2 数据模型 (model)

使用 GORM 定义数据模型，特点：
- 结构体标签定义字段类型和约束
- 自动映射到数据库表
- 支持关联查询
- 自动维护创建和更新时间

示例：
```go
type User struct {
    ID        int64     `gorm:"primaryKey;autoIncrement" json:"id"`
    Username  string    `gorm:"type:varchar(64);uniqueIndex" json:"username"`
    Password  string    `gorm:"type:varchar(128)" json:"-"`
    RealName  string    `gorm:"type:varchar(64)" json:"real_name"`
    DeptID    int64     `gorm:"index" json:"dept_id"`
    RoleCode  string    `gorm:"type:varchar(20);index" json:"role_code"`
    Status    int8      `gorm:"type:tinyint;default:1" json:"status"`
    CreatedAt time.Time `gorm:"autoCreateTime" json:"created_at"`
    UpdatedAt time.Time `gorm:"autoUpdateTime" json:"updated_at"`
}
```

#### 4.2.3 HTTP处理器 (handler)

处理HTTP请求并实现业务逻辑：
- 参数解析和校验
- 数据库操作（使用GORM）
- 事务控制
- 封装响应结果
- 错误处理

关键业务逻辑：
- **库存扣减**：使用悲观锁（SELECT ... FOR UPDATE）防止并发超卖
- **暂估入库**：标记财务状态为"未结算"
- **盘点调整**：自动计算盈亏并生成调整记录

#### 4.2.4 中间件 (middleware)

**JWT认证中间件**
- 验证Authorization头中的JWT令牌
- 解析用户信息并存入上下文
- 拦截未授权请求

**CORS中间件**
- 处理跨域请求
- 设置CORS响应头
- 处理OPTIONS预检请求

**日志中间件**
- 记录请求信息（方法、路径、IP）
- 记录响应状态和耗时
- 便于问题排查

#### 4.2.5 工具函数 (utils)

**统一响应格式**
```go
type Response struct {
    Code    int         `json:"code"`
    Message string      `json:"message"`
    Data    interface{} `json:"data,omitempty"`
}
```

**JWT工具**
- GenerateToken：生成JWT令牌
- ParseToken：解析JWT令牌

**密码工具**
- HashPassword：BCrypt加密密码
- CheckPassword：验证密码

### 4.3 已实现功能

✅ 项目结构搭建  
✅ 配置管理（Viper）  
✅ 数据库连接初始化（GORM）  
✅ 路由框架（Gin）  
✅ JWT认证中间件  
✅ CORS跨域中间件  
✅ 日志中间件  
✅ 统一响应格式  
✅ 密码加密工具  
✅ 基础数据模型（User, Department, Product）  
✅ 物资管理 CRUD  
✅ 供应商管理 CRUD  
✅ 分类管理 CRUD  
✅ 采购管理 CRUD  
✅ 入库管理 CRUD  
✅ 出库管理 CRUD  
✅ 库存查询与流水  
✅ 盘点管理 CRUD  
✅ 仪表盘统计接口

---

## 5. 前端项目结构

### 5.1 项目位置

`apps/frontend` - Vue 3 前端项目

### 5.2 技术栈

- Vue 3 (Composition API)
- Ant Design Vue (UI组件库)
- VxeTable (高性能表格组件)
- Vite 7.x (构建工具)
- Pinia (状态管理)
- Vue Router (路由管理)
- Axios (HTTP客户端)
- ECharts (图表库)
- TypeScript

### 5.3 目录结构

```
apps/frontend/
├── src/
│   ├── adapter/          # UI组件适配器
│   ├── api/              # API接口封装
│   │   ├── core/         # 核心接口（认证、用户、菜单）
│   │   └── wms/          # 业务接口（物资、采购、入库等）
│   ├── hooks/            # 组合式函数
│   ├── layouts/          # 布局组件
│   ├── locales/          # 国际化配置
│   ├── router/           # 路由配置
│   ├── store/            # Pinia状态管理
│   ├── views/            # 页面组件
│   │   ├── _core/        # 核心页面（登录、个人中心等）
│   │   ├── dashboard/    # 仪表盘
│   │   └── wms/          # 仓库管理业务页面
│   ├── app.vue           # 根组件
│   ├── main.ts           # 入口文件
│   └── preferences.ts    # 偏好设置
├── public/               # 公共资源
├── vite.config.mts       # Vite配置
├── tailwind.config.mjs   # Tailwind配置
└── package.json          # 依赖配置
```

### 5.4 核心功能模块

**仪表盘**
- 概览统计（库存总数、入库/出库统计、预警数量）
- 库存趋势图表
- 分类库存分布
- 低库存预警列表

**基础数据管理**
- 物资档案管理（含分类）
- 供应商管理

**采购管理**
- 采购单管理（CRUD + 状态流转）

**入库管理**
- 入库单管理（含暂估入库）

**出库管理**
- 出库申请与审批

**库存管理**
- 库存查询
- 库存流水
- 库存盘点

---

## 6. API接口规范

### 6.1 接口设计原则

- RESTful API设计风格
- 统一的响应格式
- 使用HTTP状态码
- JWT令牌认证
- 版本控制（/api/v1）

### 6.2 统一响应格式

```json
{
  "code": 0,
  "message": "success",
  "data": {}
}
```

**code说明：**
- 0：成功
- 400：请求参数错误
- 401：未授权
- 403：无权限
- 404：资源不存在
- 500：服务器错误

### 6.3 接口列表

#### 认证接口

| 方法 | 路径 | 说明 | 认证 |
| --- | --- | --- | --- |
| POST | /api/auth/login | 用户登录 | 否 |
| POST | /api/auth/logout | 用户登出 | 是 |
| GET | /api/user/info | 获取当前用户信息 | 是 |
| GET | /api/auth/codes | 获取权限码 | 是 |
| GET | /api/menu/all | 获取菜单列表 | 是 |

#### 仪表盘接口

| 方法 | 路径 | 说明 | 认证 |
| --- | --- | --- | --- |
| GET | /api/dashboard/overview | 概览统计 | 是 |
| GET | /api/dashboard/stock-trend | 库存趋势 | 是 |
| GET | /api/dashboard/category-stock | 分类库存分布 | 是 |
| GET | /api/dashboard/low-stock | 低库存预警 | 是 |
| GET | /api/dashboard/activities | 最近活动 | 是 |

#### 基础数据接口

| 方法 | 路径 | 说明 | 认证 |
| --- | --- | --- | --- |
| GET | /api/products | 获取物资列表 | 是 |
| GET | /api/products/:id | 获取物资详情 | 是 |
| POST | /api/products | 创建物资 | 是 |
| PUT | /api/products/:id | 更新物资 | 是 |
| DELETE | /api/products/:id | 删除物资 | 是 |
| GET | /api/suppliers | 获取供应商列表 | 是 |
| GET | /api/suppliers/:id | 获取供应商详情 | 是 |
| POST | /api/suppliers | 创建供应商 | 是 |
| PUT | /api/suppliers/:id | 更新供应商 | 是 |
| DELETE | /api/suppliers/:id | 删除供应商 | 是 |
| GET | /api/categories | 获取分类列表 | 是 |
| GET | /api/categories/tree | 获取分类树 | 是 |
| POST | /api/categories | 创建分类 | 是 |
| PUT | /api/categories/:id | 更新分类 | 是 |
| DELETE | /api/categories/:id | 删除分类 | 是 |

#### 采购管理接口

| 方法 | 路径 | 说明 | 认证 |
| --- | --- | --- | --- |
| GET | /api/procurements | 获取采购单列表 | 是 |
| GET | /api/procurements/:id | 获取采购单详情 | 是 |
| POST | /api/procurements | 创建采购单 | 是 |
| PUT | /api/procurements/:id | 更新采购单 | 是 |
| DELETE | /api/procurements/:id | 删除采购单 | 是 |

#### 入库管理接口

| 方法 | 路径 | 说明 | 认证 |
| --- | --- | --- | --- |
| GET | /api/inbounds | 获取入库单列表 | 是 |
| GET | /api/inbounds/:id | 获取入库单详情 | 是 |
| POST | /api/inbounds | 创建入库单 | 是 |
| PUT | /api/inbounds/:id | 更新入库单 | 是 |
| DELETE | /api/inbounds/:id | 删除入库单 | 是 |

#### 出库管理接口

| 方法 | 路径 | 说明 | 认证 |
| --- | --- | --- | --- |
| GET | /api/outbounds | 获取出库单列表 | 是 |
| GET | /api/outbounds/:id | 获取出库单详情 | 是 |
| POST | /api/outbounds | 创建出库单 | 是 |
| PUT | /api/outbounds/:id | 更新出库单 | 是 |
| DELETE | /api/outbounds/:id | 删除出库单 | 是 |

#### 库存管理接口

| 方法 | 路径 | 说明 | 认证 |
| --- | --- | --- | --- |
| GET | /api/inventory/stock | 查询库存列表 | 是 |
| GET | /api/inventory/stock/:id | 查询库存详情 | 是 |
| GET | /api/inventory/logs | 查询库存流水 | 是 |
| GET | /api/inventory/checks | 获取盘点任务列表 | 是 |
| GET | /api/inventory/checks/:id | 获取盘点任务详情 | 是 |
| POST | /api/inventory/checks | 创建盘点任务 | 是 |
| PUT | /api/inventory/checks/:id | 更新盘点任务 | 是 |
| DELETE | /api/inventory/checks/:id | 删除盘点任务 | 是 |

---

## 7. 开发规范

### 7.1 代码规范

**Go代码规范**
- 遵循 Go 官方代码规范
- 使用 `gofmt` 格式化代码
- 使用 `golint` 进行代码检查
- 变量命名使用驼峰命名法
- 常量使用全大写加下划线

**Vue代码规范**
- 遵循 Vue 3 官方风格指南
- 组件名使用 PascalCase
- 使用 Composition API
- Props 定义使用对象形式
- 使用 ESLint 进行代码检查

### 7.2 Git提交规范

```
<type>(<scope>): <subject>

<body>

<footer>
```

**type类型：**
- feat: 新功能
- fix: 修复bug
- docs: 文档更新
- style: 代码格式调整
- refactor: 代码重构
- test: 测试相关
- chore: 构建/工具链相关

**示例：**
```
feat(product): 添加物资档案管理功能

- 实现物资列表查询
- 实现物资新增功能
- 实现物资编辑功能

Closes #123
```

### 7.3 数据库规范

- 表名使用小写加下划线
- 字段名使用小写加下划线
- 主键统一使用 `id`
- 时间字段统一使用 `created_at` 和 `updated_at`
- 外键字段命名：`关联表_id`
- 索引命名：`idx_字段名` 或 `uk_字段名`（唯一索引）

### 7.4 注释规范

**Go注释**
```go
// GetUserByID 根据ID获取用户信息
// @param id 用户ID
// @return user 用户信息
// @return error 错误信息
func GetUserByID(id int64) (*User, error) {
    // 实现代码
}
```

**Vue注释**
```vue
<script setup>
/**
 * 获取物资列表
 * @param {Object} params - 查询参数
 * @returns {Promise} 物资列表数据
 */
const getProductList = async (params) => {
  // 实现代码
}
</script>
```

---

## 8. 部署说明

### 8.1 开发环境部署

**1. 初始化数据库**
```bash
mysql -u root -p < db/init_all.sql
```

**2. 配置后端**
```bash
cd apps/backend
cp config/config.example.yaml config/config.yaml
# 编辑 config.yaml，配置数据库连接信息
go mod download
go run cmd/server/main.go
```

**3. 配置前端**
```bash
# 在项目根目录执行
pnpm install
pnpm dev:frontend
```

### 8.2 生产环境部署

**使用Docker部署（推荐）**

1. 构建后端镜像
2. 构建前端镜像
3. 使用 docker-compose 编排服务
4. 配置 Nginx 反向代理

**传统部署**

1. 编译Go程序：`go build -o easywms cmd/server/main.go`
2. 构建前端：`pnpm build`
3. 配置Nginx
4. 使用systemd管理后端服务

### 8.3 注意事项

1. **数据库字符集**：必须使用 `utf8mb4` 以支持完整的Unicode字符
2. **密码加密**：使用 BCrypt 算法，成本因子为默认值（10）
3. **并发控制**：库存扣减使用悲观锁（SELECT ... FOR UPDATE）
4. **事务处理**：入库、出库操作必须在事务中执行
5. **外键约束**：已添加外键约束，删除操作需注意级联关系
6. **JWT密钥**：生产环境必须修改JWT密钥
7. **CORS配置**：生产环境需配置正确的允许域名

---

## 9. 附录

### 9.1 常见问题

**Q: 如何重置数据库？**
A: 删除数据库后重新执行 schema.sql 和 data.sql

**Q: 如何修改默认端口？**
A: 修改 config/config.yaml 中的 server.port 配置

**Q: 如何添加新的角色？**
A: 在 sys_user 表的 role_code 字段中添加新的角色代码，并在前端路由守卫中配置权限

### 9.2 参考资料

- [Go官方文档](https://golang.org/doc/)
- [Gin框架文档](https://gin-gonic.com/docs/)
- [GORM文档](https://gorm.io/docs/)
- [Vue 3文档](https://vuejs.org/)
- [Element Plus文档](https://element-plus.org/)

---

**文档结束**
